<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Rescale design weights for multilevel analysis — rescale_weights • parameters</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Rescale design weights for multilevel analysis — rescale_weights" />
<meta property="og:description" content="Most functions to fit multilevel and mixed effects models only
   allow to specify frequency weights, but not design (i.e. sampling or probability)
   weights, which should be used when analyzing complex samples and survey data.
   rescale_weights() implements an algorithm proposed by Asparouhov (2006)
   and Carle (2009) to rescale design weights in survey data to account for
   the grouping structure of multilevel models, which then can be used for
   multilevel modelling." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">parameters</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Features</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Parameters Description
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/model_parameters.html">Summary of Model Parameters</a>
    </li>
    <li>
      <a href="../articles/model_parameters_standardized.html">Standardized Model Parameters</a>
    </li>
    <li>
      <a href="../articles/model_parameters_robust.html">Robust Estimation of Standard Errors</a>
    </li>
    <li>
      <a href="../articles/demean.html">Panel Data Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/parameters_selection.html">Parameters Selection</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Dimension Reduction
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/parameters_reduction.html">Feature reduction (PCA, cMDS, ICA...)</a>
    </li>
    <li>
      <a href="../articles/efa_cfa.html">Structural models (EFA, CFA, SEM...)</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/easystats/parameters/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Rescale design weights for multilevel analysis</h1>
    <small class="dont-index">Source: <a href='https://github.com/easystats/parameters/blob/master/R/rescale_weights.R'><code>R/rescale_weights.R</code></a></small>
    <div class="hidden name"><code>rescale_weights.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Most functions to fit multilevel and mixed effects models only
   allow to specify frequency weights, but not design (i.e. sampling or probability)
   weights, which should be used when analyzing complex samples and survey data.
   <code>rescale_weights()</code> implements an algorithm proposed by <cite>Asparouhov (2006)</cite>
   and <cite>Carle (2009)</cite> to rescale design weights in survey data to account for
   the grouping structure of multilevel models, which then can be used for
   multilevel modelling.</p>
    </div>

    <pre class="usage"><span class='fu'>rescale_weights</span>(<span class='no'>data</span>, <span class='no'>group</span>, <span class='no'>probability_weights</span>, <span class='kw'>nest</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame.</p></td>
    </tr>
    <tr>
      <th>group</th>
      <td><p>Variable names (as character vector),  indicating the grouping
structure (strata) of the survey data (level-2-cluster variable). It is
also possible to create weights for multiple group variables; in such cases,
each created weighting variable will be suffixed by the name of the group
variable.</p></td>
    </tr>
    <tr>
      <th>probability_weights</th>
      <td><p>Variable indicating the probability (design or sampling)
weights of the survey data (level-1-weight).</p></td>
    </tr>
    <tr>
      <th>nest</th>
      <td><p>Logical, if <code>TRUE</code> and <code>group</code> indicates at least two
group variables, then groups are "nested", i.e. groups are now a combination
from each group level of the variables in <code>group</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>data</code>, including the new weighting variables: <code>pweights_a</code> and <code>pweights_b</code>, which represent the rescaled design weights to use in multilevel models (use these variables for the <code>weights</code> argument).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Rescaling is based on two methods: For <code>pweights_a</code>, the sample
   weights <code>probability_weights</code> are adjusted by a factor that represents the proportion
   of group size divided by the sum of sampling weights within each group.
   The adjustment factor for <code>pweights_b</code> is the sum of sample weights
   within each group divided by the sum of squared sample weights within
   each group (see <cite>Carle (2009)</cite>, Appendix B).
   <br /> <br />
   Regarding the choice between scaling methods A and B, Carle suggests
   that "analysts who wish to discuss point estimates should report results
   based on weighting method A. For analysts more interested in residual
   between-group variance, method B may generally provide the least biased
   estimates". In general, it is recommended to fit a non-weighted model
   and weighted models with both scaling methods and when comparing the
   models, see whether the "inferential decisions converge", to gain
   confidence in the results.
   <br /> <br />
   Though the bias of scaled weights decreases with increasing group size,
   method A is preferred when insufficient or low group size is a concern.
   <br /> <br />
   The group ID and probably PSU may be used as random effects (e.g.
   nested design, or group and PSU as varying intercepts), depending
   on the survey design that should be mimicked.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ul>
<li><p>Carle A.C. (2009). Fitting multilevel models in complex survey data with design weights: Recommendations. BMC Medical Research Methodology 9(49): 1-13</p></li>
<li><p>Asparouhov T. (2006). General Multi-Level Modeling with Sampling Weights. Communications in Statistics - Theory and Methods 35: 439-460</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/library.html'>require</a></span>(<span class='st'>"sjstats"</span>)) {
  <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>nhanes_sample</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"sjstats"</span>)
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>rescale_weights</span>(<span class='no'>nhanes_sample</span>, <span class='st'>"SDMVSTRA"</span>, <span class='st'>"WTINT2YR"</span>))

  <span class='co'># also works with multiple group-variables...</span>
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='fu'>rescale_weights</span>(<span class='no'>nhanes_sample</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"SDMVSTRA"</span>, <span class='st'>"SDMVPSU"</span>), <span class='st'>"WTINT2YR"</span>))

  <span class='co'># or nested structures.</span>
  <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>rescale_weights</span>(
    <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>nhanes_sample</span>,
    <span class='kw'>group</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"SDMVSTRA"</span>, <span class='st'>"SDMVPSU"</span>),
    <span class='kw'>probability_weights</span> <span class='kw'>=</span> <span class='st'>"WTINT2YR"</span>,
    <span class='kw'>nest</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>
  )
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>x</span>)
}</div><div class='output co'>#&gt; <span class='message'>Loading required package: sjstats</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: 'sjstats'</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from 'package:metafor':</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    robust</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from 'package:rstanarm':</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    se</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from 'package:psych':</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    phi</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from 'package:parameters':</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    p_value</span></div><div class='output co'>#&gt;   total  age RIAGENDR RIDRETH1 SDMVPSU SDMVSTRA WTINT2YR pweights_a pweights_b
#&gt; 1     1 2.20        1        3       2       31 97593.68  1.6532834  1.3583967
#&gt; 2     7 2.08        2        3       1       29 39599.36  0.5492655  0.4875798
#&gt; 3     3 1.48        2        1       2       42 26619.83  0.8341084  0.5891700
#&gt; 4     4 1.32        2        4       2       33 34998.53  0.7937824  0.5941006
#&gt; 5     1 2.00        2        1       1       41 14746.45  0.4285939  0.3068214
#&gt; 6     6 2.20        2        4       1       38 28232.10  0.6215579  0.4759935</div><div class='input'>
<span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/library.html'>require</a></span>(<span class='st'>"lme4"</span>) <span class='kw'>&amp;&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/library.html'>require</a></span>(<span class='st'>"sjstats"</span>)) {
  <span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>nhanes_sample</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"sjstats"</span>)
  <span class='no'>nhanes_sample</span> <span class='kw'>&lt;-</span> <span class='fu'>rescale_weights</span>(<span class='no'>nhanes_sample</span>, <span class='st'>"SDMVSTRA"</span>, <span class='st'>"WTINT2YR"</span>)
  <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/glmer.html'>glmer</a></span>(
    <span class='no'>total</span> ~ <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>RIAGENDR</span>) * (<span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='no'>age</span>) + <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>RIDRETH1</span>)) + (<span class='fl'>1</span> <span class='kw'>|</span> <span class='no'>SDMVPSU</span>),
    <span class='kw'>family</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span>(),
    <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>nhanes_sample</span>,
    <span class='kw'>weights</span> <span class='kw'>=</span> <span class='no'>pweights_a</span>
  )
}</div><div class='output co'>#&gt; Generalized linear mixed model fit by maximum likelihood (Laplace
#&gt;   Approximation) [glmerMod]
#&gt;  Family: poisson  ( log )
#&gt; Formula: total ~ factor(RIAGENDR) * (log(age) + factor(RIDRETH1)) + (1 |  
#&gt;     SDMVPSU)
#&gt;    Data: nhanes_sample
#&gt; Weights: pweights_a
#&gt;       AIC       BIC    logLik  deviance  df.resid 
#&gt;  78844.27  78920.47 -39409.14  78818.27      2582 
#&gt; Random effects:
#&gt;  Groups  Name        Std.Dev.
#&gt;  SDMVPSU (Intercept) 0.1018  
#&gt; Number of obs: 2595, groups:  SDMVPSU, 2
#&gt; Fixed Effects:
#&gt;                         (Intercept)                    factor(RIAGENDR)2  
#&gt;                            2.491801                            -1.021308  
#&gt;                            log(age)                    factor(RIDRETH1)2  
#&gt;                            0.838726                            -0.088627  
#&gt;                   factor(RIDRETH1)3                    factor(RIDRETH1)4  
#&gt;                           -0.013333                             0.722511  
#&gt;                   factor(RIDRETH1)5           factor(RIAGENDR)2:log(age)  
#&gt;                           -0.106521                            -1.012695  
#&gt; factor(RIAGENDR)2:factor(RIDRETH1)2  factor(RIAGENDR)2:factor(RIDRETH1)3  
#&gt;                           -0.009086                             0.732985  
#&gt; factor(RIAGENDR)2:factor(RIDRETH1)4  factor(RIAGENDR)2:factor(RIDRETH1)5  
#&gt;                            0.275967                             0.542074  </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://github.com/strengejacke'>Daniel Lüdecke</a>, <a href='https://dominiquemakowski.github.io/'>Dominique Makowski</a>, <a href='https://github.com/mattansb'>Mattan S. Ben-Shachar</a>, Indrajeet Patil, Søren Højsgaard.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


